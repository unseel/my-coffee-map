<html>

<head>
    <title>My Coffee Map</title>
    <!-- 載入 leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <style>
        html,
        body {
            padding: 0;
            margin: 0;
        }

        #myMap {
            width: 100vw;
            height: 100vh;
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=b7087137142bbf8632d59d6999b86c19"></script>
</head>

<body>
    <div id="myMap"></div>
    <script>
        // 模擬資料
        const data = [
            { name: "stanley咖啡", local: [30.289065, 120.034595], address: "浙江省杭州市余杭区五常街道西溪悦城26幢102室-1号" }
        ];
        // 設定地圖中心點與放大倍率
        const map = L.map("myMap", {
            center: [30.283695, 120.000604],
            zoom: 13
        });
        // 載入圖資
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution:
                '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>         contributors'
        }).addTo(map);
        // 創建 icon (金色)
        const goldIcon = new L.Icon({
            iconUrl:
                "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png",
            shadowUrl:
                "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        // 創建 icon (黑色)
        const blackIcon = new L.Icon({
            iconUrl:
                "https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png",
            shadowUrl:
                "https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });
        // 宣告一個圖層
        const markers = new L.MarkerClusterGroup().addTo(map);
        // 處理資料
        data.forEach(item => {
            // 夢時代購物中心 icon 顯示金色，其餘則為黑色
            let myIcon;
            if (item.name === "夢時代購物中心") {
                myIcon = goldIcon;
            } else {
                myIcon = blackIcon;
            }
            // 將標記點新增於圖層
            markers.addLayer(
                L.marker(item.local, {
                    title: item.name + "\n" + item.address,
                    icon: myIcon
                })
                    .addTo(map)
                    .bindPopup(item.name)
            );
        });

        AMap.plugin('AMap.Geolocation', function() {
            var geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,//是否使用高精度定位，默认:true
                timeout: 10000,          //超过10秒后停止定位，默认：5s
                buttonPosition:'RB',    //定位按钮的停靠位置
                buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
                zoomToAccuracy: true,   //定位成功后是否自动调整地图视野到定位点

            });
            geolocation.getCurrentPosition(function(status,result){
                if(status=='complete'){
                    onComplete(result)
                }else{
                    onError(result)
                }
            });
        });
        //解析定位结果
        function onComplete(data) {
            position = data.position;
            var lat = position.getLat();
            var lng = position.getLng();
            console.log(lat, lng);
            this.center = [lat, lng];
            map.setView(center);
        }
        //解析定位错误信息
        function onError(data) {
            console.log(data);
        }
    </script>

</body>

</html>